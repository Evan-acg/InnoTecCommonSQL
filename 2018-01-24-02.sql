
SELECT ISNULL(T1.ITMREF_0,T2.ITMREF_0) N'产品编码',
		ISNULL(T1.STA_0,T2.STA_0) N'状态',
		ISNULL(T1.QTY_0,0) N'当前库存',
		ISNULL(T2.QTY_0,0) N'待入库',
		ISNULL(T1.QTY_0,0) + ISNULL(T2.QTY_0,0) N'库存合计'
FROM (SELECT ITMREF_0,STA_0,SUM(QTYSTU_0) QTY_0 FROM STOCK WHERE LOC_0 = N'MI1' AND STOFCY_0 = N'0101' GROUP BY ITMREF_0,STA_0) T1
	FULL JOIN (SELECT ITMREF_0,N'A' STA_0,SUM(QTYSTU_0) - SUM(RCPQTYSTU_0) QTY_0  FROM PORDERQ WHERE CREUSR_0  IN(N'0031',N'0078') AND LINCLEFLG_0 <> 2 AND QTYSTU_0 <> RCPQTYSTU_0 AND POHFCY_0 = N'0101' GROUP BY ITMREF_0) T2 ON T2.ITMREF_0 = T1.ITMREF_0 AND T1.STA_0 = T2.STA_0

SELECT ITMREF_0,N'A' STA_0,SUM(QTY_0) - SUM(DLVQTY_0) QTY_0  FROM SORDERQ WHERE CREUSR_0  IN(N'0031',N'0078') AND SOQSTA_0 <> 3 AND QTY_0 <> DLVQTY_0 AND SALFCY_0 = N'0101' GROUP BY ITMREF_0
SELECT *
FROM (SELECT ITMREF_0 FROM ITMFACILIT T1 WHERE STOFCY_0 = N'0101') T1
	LEFT JOIN (SELECT ITMREF_0,STA_0,SUM(QTYSTU_0) QTY_0 FROM STOCK WHERE LOC_0 = N'MI1' AND STOFCY_0 = N'0101' GROUP BY ITMREF_0,STA_0) T2 ON T1.ITMREF_0 = T2.ITMREF_0
	LEFT JOIN (SELECT ITMREF_0,N'A' STA_0,SUM(QTYSTU_0) - SUM(RETQTYSTU_0) QTY_0  FROM PORDERQ WHERE CREUSR_0  IN(N'0031',N'0078') AND LINSTA_0 <> 3 AND QTYSTU_0 <> RETQTYSTU_0 GROUP BY ITMREF_0) T3 ON T1.ITMREF_0 = T3.ITMREF_0 

(SELECT ITMREF_0,N'A' STA_0,SUM(QTYSTU_0) - SUM(RETQTYSTU_0) QTY_0  FROM PORDERQ WHERE CREUSR_0  IN(N'0031',N'0078') AND LINSTA_0 <> 3 AND QTYSTU_0 <> RETQTYSTU_0 GROUP BY ITMREF_0)
SELECT * FROM PORDERQ WHERE POHNUM_0 = N'0101POH17120651'


SELECT *  FROM SORDERQ WHERE CREUSR_0  IN(N'0031',N'0078') AND SOQSTA_0 <> 3 AND QTY_0 <> DLVQTY_0 AND SALFCY_0 = N'0101' AND ITMREF_0 = N'IGU0080-24'
SELECT *  FROM PORDERQ WHERE CREUSR_0  IN(N'0031',N'0078') AND LINSTA_0 <> 3 AND QTYSTU_0 <> RCPQTYSTU_0 AND POHFCY_0 = N'0101' AND ITMREF_0 = N'MSM0663'
SELECT * FROM PORDERQ WHERE CREUSR_0  IN(N'0031',N'0078')  AND ITMREF_0 = N'MSM0663'

SELECT TOP 100 * FROM SORDERQ WHERE POHNUM_0 = N'0101POH17030850'
SELECT * FROM SORDERQ WHERE SOHNUM_0 = N'0101SOH17030544'
SELECT CLELINNBR_0,* FROM PORDER WHERE POHNUM_0 = N'0101POH17030850'


DECLARE @POHNUM NVARCHAR(100)
SET @POHNUM = N'0101POH17040670'
UPDATE PORDER SET CLELINNBR_0 = 0 WHERE POHNUM_0 = @POHNUM
UPDATE PORDER SET CLEFLG_0 = 1 WHERE POHNUM_0 = @POHNUM
UPDATE PORDERQ SET LINCLEFLG_0 = 2 WHERE POHNUM_0 = @POHNUM

SELECT SOQSTA_0,* FROM SORDERQ WHERE SOHNUM_0 = N'0101SOH17050158'


SELECT * FROM STOCK WHERE ITMREF_0 = N'MCT6337'
SELECT * FROM STOJOU WHERE 

SELECT ITMREF_0,N'A' STA_0,SUM(QTY_0) - SUM(DLVQTY_0) QTY_0  FROM SORDERQ WHERE CREUSR_0  IN(N'0031',N'0078') AND SOQSTA_0 <> 3 AND QTY_0 <> DLVQTY_0 AND SALFCY_0 = N'0101' GROUP BY ITMREF_0


SELECT * FROM PORDERQ WHERE POHNUM_0 LIKE N'%17090050' AND ITMREF_0 = N''
SELECT * FROM PRECEIPTD WHERE PTHNUM_0 = N'0101REC17090501' AND PTDLIN_0 = N'3000'

SELECT * FROM STOJOU WHERE ITMREF_0 = N'IGU0080-24' AND VCRNUM_0 = N'0101REC17090501'
SELECT * FROM STOJOU WHERE LOT_0 = N'LO170302021620' AND STOFCY_0 = N'0101' ORDER BY IPTDAT_0

SELECT * FROM STOALL WHERE ITMREF_0 = N'ICN0951'





















