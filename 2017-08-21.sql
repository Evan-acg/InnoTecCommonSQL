SELECT * FROM (SELECT ITMREF_0,MFGFCY_0,STRDAT_0,SUM(RMNEXTQTY_0) RMNEXTQTY_0 FROM MFGITM WHERE MFGFCY_0 = '0202' AND MFGSTA_0 <> 4 AND ITMSTA_0 < 3  GROUP BY ITMREF_0,MFGFCY_0,STRDAT_0) T1 ORDER BY T1.ITMREF_0

SELECT TOP 1000 * FROM STOCK
SELECT TOP 1000 * FROM STOCK WHERE STOFCY_0 = '0202'
SELECT A1.*,ISNULL(QTYPCU_0,0),ISNULL(QTYSTU_0,0)
FROM
	(SELECT TOP 1000 
			T2.ITMREF_0,
			T2.ITMDES1_0,
			T2.STU_0 
	FROM MFGITM T1 
		LEFT JOIN ITMMASTER T2 ON T1.ITMREF_0 = T2.ITMREF_0 
	WHERE T1.MFGFCY_0 = '0202' 
		AND T1.MFGSTA_0 <> 4 
		AND T1.ITMSTA_0 < 3
	GROUP BY T2.ITMREF_0,T2.ITMDES1_0,T2.STU_0
	) A1
LEFT JOIN (SELECT ITMREF_0,SUM(QTYPCU_0) QTYPCU_0 FROM STOCK WHERE STOFCY_0 = N'0202' AND STA_0 NOT LIKE N'R%' GROUP BY ITMREF_0) A2 ON A1.ITMREF_0 = A2.ITMREF_0
LEFT JOIN (SELECT ITMREF_0,SUM(QTYSTU_0) QTYSTU_0 FROM STOALL WHERE STOFCY_0 = '0202' GROUP BY ITMREF_0) A3 ON A1.ITMREF_0 = A3.ITMREF_0




SELECT A1.*,ISNULL(A2.QTYPCU_0,0),ISNULL(A3.QTYSTU_0,0)
FROM(
	SELECT T2.ITMREF_0,T2.ITMDES1_0,T2.STU_0
	FROM MFGMAT T1
		LEFT JOIN ITMMASTER T2 ON T1.ITMREF_0 = T2.ITMREF_0
	WHERE T1.MATSTA_0 < 3
		AND T1.MFGFCY_0 = '0202'
		AND T1.RETQTY_0 <> USEQTY_0 
	GROUP BY T2.ITMREF_0,T2.ITMDES1_0,T2.STU_0
	) A1
LEFT JOIN (SELECT ITMREF_0,SUM(QTYPCU_0) QTYPCU_0 FROM STOCK WHERE STOFCY_0 = N'0202' AND STA_0 NOT LIKE N'R%' GROUP BY ITMREF_0) A2 ON A1.ITMREF_0 = A2.ITMREF_0
LEFT JOIN (SELECT ITMREF_0,SUM(QTYSTU_0) QTYSTU_0 FROM STOALL WHERE STOFCY_0 = '0202' GROUP BY ITMREF_0) A3 ON A1.ITMREF_0 = A3.ITMREF_0

SELECT TOP 100 * FROM MFGMAT

SELECT  T1.MFGNUM_0,
		T1.ITMREF_0,
		(CASE WHEN T3.QTYPCU_0 >= T2.RETQTY_0 THEN MIN(T2.RETQTY_0 / T2.BOMQTY_0) ELSE MIN((T2.RETQTY_0 - T3.QTYPCU_0) / T2.BOMQTY_0 ) END )
FROM MFGITM T1
	LEFT JOIN MFGMAT T2 ON T1.MFGNUM_0 = T2.MFGNUM_0
	LEFT JOIN (SELECT ITMREF_0,STOFCY_0,SUM(QTYPCU_0) QTYPCU_0 FROM STOCK GROUP BY ITMREF_0,STOFCY_0) T3 ON T1.ITMREF_0 = T3.ITMREF_0 AND T3.STOFCY_0 = '0202'
WHERE T1.ITMREF_0 = 'IGG0013'
	AND T1.MFGFCY_0 = '0202' 
	AND T1.MFGSTA_0 <> 4 
	AND T1.ITMSTA_0 < 3
GROUP BY T1.MFGNUM_0,T1.ITMREF_0

SELECT * FROM MFGITM WHERE MFGNUM_0 = '0202MFG17080587'

SELECT * FROM MFGMAT WHERE MFGNUM_0 = '0202MFG17080587'

SELECT T1.ITMREF_0 N'物料编码',
		T3.ITMDES1_0  N'物料名称',
		T1.EXTQTY_0  N'成品工单数量',
		T1.CPLQTY_0 N'已经完工数量',
		T2.MFGNUM_0 N'工单号',
		T2.ITMREF_0 N'组件',
		T2.RETQTY_0 N'需求',
		T2.USEQTY_0 N'已消耗',
		T1.STRDAT_0 N'开始日期'
FROM MFGITM T1
	LEFT JOIN MFGMAT T2 ON T1.MFGNUM_0 = T2.MFGNUM_0 AND T1.MFGLIN_0 = '1000'
	LEFT JOIN ITMMASTER T3 ON T1.ITMREF_0 = T3.ITMREF_0
WHERE T1.MFGFCY_0 = '0202' 
	AND T1.MFGSTA_0 <> 4 
	AND T1.ITMSTA_0 < 3 
	AND T1.ITMREF_0 = 'IGG0020'
ORDER BY T1.STRDAT_0
SELECT T1.ITMREF_0 N'物料编码', T3.ITMDES1_0  N'物料名称',  T1.EXTQTY_0  N'成品工单数量',   T1.CPLQTY_0 N'已经完工数量',    T2.MFGNUM_0 N'工单号',  T2.ITMREF_0 N'组件',    T2.RETQTY_0 N'需求',    T2.USEQTY_0 N'已消耗',  T1.STRDAT_0 N'开始日期' FROM MFGITM T1 LEFT JOIN MFGMAT T2 ON T1.MFGNUM_0 = T2.MFGNUM_0 AND T1.MFGLIN_0 = '1000' LEFT JOIN ITMMASTER T3 ON T1.ITMREF_0 = T3.ITMREF_0 WHERE T1.MFGFCY_0 = '0202' AND T1.MFGSTA_0 <> 4 AND T1.ITMSTA_0 < 3 AND T1.ITMREF_0 = '' ORDER BY T1.STRDAT_0


SELECT TOP 100 * FROM MFGITM
SELECT TOP 100 * FROM ZSOYN


SELECT T1.MFGNUM_0,
		T2.BPCNAM_0,
		T1.ITMREF_0,
		T1.EXTQTY_0,
		T1.CPLQTY_0,
		T1.EXTQTY_0 - T1.CPLQTY_0 LEFQTY_0,
		T1.STRDAT_0
FROM MFGITM T1
	LEFT JOIN ZSOYN T2 ON T1.VCRNUMORI_0 = T2.XSOHNUM_0 AND T1.VCRLINORI_0 = T2.XSOPLIN_0
WHERE T1.MFGFCY_0 = '0202' 
	AND T1.MFGSTA_0 <> 4 
	AND T1.ITMSTA_0 < 3
	AND T1.STRDAT_0 BETWEEN (GETDATE() -7) AND (GETDATE() + 14)
	--AND T1.MFGNUM_0 = ''
ORDER BY T1.STRDAT_0

SELECT T1.MFGNUM_0,T2.BPCNAM_0,T1.ITMREF_0,T1.EXTQTY_0,T1.CPLQTY_0,T1.STRDAT_0 FROM MFGITM T1  LEFT JOIN ZSOYN T2 ON T1.VCRNUMORI_0 = T2.XSOHNUM_0 AND T1.VCRLINORI_0 = T2.XSOPLIN_0 WHERE T1.MFGFCY_0 = '0202'     AND T1.MFGSTA_0 <> 4    AND T1.ITMSTA_0 < 3 AND T1.MFGNUM_0 = ''ORDER BY T1.STRDAT_0
SELECT T1.MFGNUM_0,T2.BPCNAM_0,T1.ITMREF_0,T1.EXTQTY_0,T1.CPLQTY_0,T1.STRDAT_0 FROM MFGITM T1  LEFT JOIN ZSOYN T2 ON T1.VCRNUMORI_0 = T2.XSOHNUM_0 AND T1.VCRLINORI_0 = T2.XSOPLIN_0 WHERE T1.MFGFCY_0 = '0202'     AND T1.MFGSTA_0 <> 4    AND T1.ITMSTA_0 < 3 AND T1.MFGNUM_0 = '0202MFG17080058'ORDER BY T1.STRDAT_0


SELECT * FROM ORDERS WHERE ITMREF_0 = 'ICZ6087-08'


SELECT A1.*,ISNULL(A2.QTYPCU_0,0),ISNULL(A3.QTYSTU_0,0)
FROM(
	SELECT T2.ITMREF_0,T2.ITMDES1_0,T2.STU_0
	FROM MFGMAT T1
		LEFT JOIN ITMMASTER T2 ON T1.ITMREF_0 = T2.ITMREF_0
		LEFT JOIN ITMFACILIT T3 ON T1.ITMREF_0 = T3.ITMREF_0 AND T3.STOFCY_0 = '0202'
	WHERE T1.MATSTA_0 < 3
		AND T1.MFGFCY_0 = '0202'
		AND T1.RETQTY_0 <> USEQTY_0 
		AND T3.REOCOD_0 = '2'
	GROUP BY T2.ITMREF_0,T2.ITMDES1_0,T2.STU_0
	) A1
LEFT JOIN (SELECT ITMREF_0,SUM(QTYPCU_0) QTYPCU_0 FROM STOCK WHERE STOFCY_0 = N'0202' AND STA_0 NOT LIKE N'R%' GROUP BY ITMREF_0) A2 ON A1.ITMREF_0 = A2.ITMREF_0
LEFT JOIN (SELECT ITMREF_0,SUM(QTYSTU_0) QTYSTU_0 FROM STOALL WHERE STOFCY_0 = '0202' GROUP BY ITMREF_0) A3 ON A1.ITMREF_0 = A3.ITMREF_0


SELECT SOHNUM_0 FROM ZTSDELIVERYD WHERE SOHNUM_0 LIKE '0101SDN170821%' GROUP BY SOHNUM_0

SELECT SOHNUM_0 FROM ZTSDELIVERYD WHERE SOHNUM_0 LIKE '0101SOH1708%' GROUP BY SOHNUM_0

SELECT FMINUM_0,FMILIN_0,ITMREF_0,* FROM SORDERQ WHERE SOHNUM_0 = '0101SOH17070154' AND ITMREF_0 IN('MVT9108','MVT0118')

0101POH17070254	3000	MVT0118
0101POH17070254	2000	MVT9108

SELECT * FROM PORDERQ WHERE POHNUM_0 = '0101POH17070254'



UPDATE SORDERQ SET FMINUM_0 = '' WHERE SOHNUM_0 = '0101SOH17070154' AND ITMREF_0 IN('MVT9108','MVT0118')
UPDATE SORDERQ SET SOQSTA_0 = 1 WHERE SOHNUM_0 = '0101SOH17070154' AND ITMREF_0 IN('MVT9108','MVT0118')

SELECT * FROM  ZTSDELIVERYD

UPDATE SORDERQ SET

SELECT * FROM 

SELECT * FROM AUTILIS WHERE USR_0 = '0078'
UPDATE AUTILIS SET PASSE_0 = (SELECT PASSE_0 FROM AUTILIS WHERE USR_0 = '0003') WHERE USR_0 = '0078'

SELECT * FROM AUDITH  T1


SELECT TOP 1000 T1.SDNNUM_0 N'发货通知单号', T1.SOHNUM_0 N'销售订单号', T1.BPCORD_0 N'客户代码', T1.BPCNAM_0 N'客户名称', T1.ITMREF_0 N'产品代码', T1.ITMDES1_0 N'产品名称', T1.QTY_0 N'订单数量', T1.DLVQTY_0 N'已发货数量', T1.LFTQTY_0 N'待发数量', T1.RETQTY_0 N'本次通知数量', T1.ZRMK_0 N'摘要', T1.ZCUSNUM_0 N'客户订单号' FROM ZTSDELIVERYD T1  WHERE SDHNUM_0 = N'0101SDN17080001'


SELECT T2.BPDNAM_0 N'客户名称',
		T1.ITMREF_0 N'产品编码',
		T1.ITMDES1_0 N'产品名称',
		T1.SDHNUM_0 N'发货单号',
		T1.QTY_0 N'发货数量',
		T1.GROPRI_0 N'单价',
		T1.QTY_0 * T1.GROPRI_0 N'合计',
		T1.CREDAT_0 N'发货日期'
FROM SDELIVERYD T1
	LEFT JOIN SDELIVERY T2 ON T1.SDHNUM_0 = T2.SDHNUM_0
WHERE T1.BPCORD_0 = 'CHN-GD-4866'
	AND T1.CREDAT_0 BETWEEN '2017-08-18' AND '2017-08-20'

SELECT * FROM 

SELECT TOP 1000 T1.SDNNUM_0 N'发货通知单号', T1.SOHNUM_0 N'销售订单号', T1.BPCORD_0 N'客户代码', T1.BPCNAM_0 N'客户名称', T1.ITMREF_0 N'产品代码', T1.ITMDES1_0 N'产品名称', T1.QTY_0 N'订单数量', T1.DLVQTY_0 N'已发货数量', T1.LFTQTY_0 N'待发数量', T1.RETQTY_0 N'本次通知数量', T1.ZRMK_0 N'摘要', T1.ZCUSNUM_0 N'客户订单号' FROM ZTSDELIVERYD T1  WHERE CREUSR_0 = N'0003'
















