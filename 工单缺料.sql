--SELECT * FROM MFGMAT
--SELECT * FROM MFGHEAD
--SELECT * FROM MFGITM
--SELECT * FROM ORDERS
--SELECT * FROM ZSOYN


SELECT T1.MFGFCY_0 N'地点',
		T1.CREDAT_0 N'制单日期',
		T1.MFGNUM_0 N'工单号',
		T1.ITMREF_0 N'组件编码',
		T3.ITMDES1_0 N'组件名称',
		T1.STU_0 N'单位',
		T1.RETQTY_0 N'需求数量',
		T1.USEQTY_0 N'已经消耗数量',
		(T1.RETQTY_0 - T1.USEQTY_0) N'缺料数量',
		T4.ITMREF_0  N'成品编码',
		T6.BPCNAM_0
FROM MFGMAT T1
	LEFT JOIN MFGHEAD T2 ON T1.MFGNUM_0 = T2.MFGNUM_0
	LEFT JOIN ITMMASTER T3 ON T1.ITMREF_0 = T3.ITMREF_0
	LEFT JOIN MFGITM T4 ON T1.MFGNUM_0 = T4.MFGNUM_0 AND T4.MFGLIN_0 = 1000
	LEFT JOIN ORDERS T5 ON T1.MFGNUM_0 = T5.VCRNUM_0 AND T1.MFGLIN_0 = T5.VCRLIN_0 AND T1.MFGFCY_0 = T5.STOFCY_0 AND T1.ITMREF_0 = T5.ITMREF_0
	LEFT JOIN ZSOYN T6 ON T5.VCRNUMORI_0 = T6.XSOHNUM_0 AND T5.VCRLINORI_0 = T6.XSOPLIN_0
WHERE T1.STA_0 <> 4 
	AND T2.MFGSTA_0 <> 4
	AND T4.MFGSTA_0 <> 4


--SELECT * FROM ORDERS WHERE VCRNUM_0 = '0202MFG17050156'
