SELECT * FROM ZSORDERD WHERE SOHNUM_0 = 'SYJOYBK0421001'
SELECT * FROM ZSORDERH WHERE SOHNUM_0 = 'SYJOYBK0421001'

DELETE FROM ZSORDERD WHERE SOHNUM_0 = 'SYJOYBK0421001' AND ITMREF_0 = 'IFT0735'
DELETE FROM ZSORDERH WHERE SOHNUM_0 = 'SYJOYBK0420001' 


SELECT * FROM SORDERQ WHERE SOHNUM_0 = '0101SOH17030600' AND ITMREF_0 = 'IGB0071-24'
SELECT * FROM PORDERQ WHERE SOHNUM_0 = '0101POH17040410' AND ITMREF_0 = 'IGB0071-24'
SELECT * FROM SORDERQ WHERE ITMREF_0 = 'IGB0071-24'

SELECT * FROM ORDERS WHERE VCRNUMORI_0 = '0202SOH17040116'
DELETE FROM SORDERQ WHERE SOHNUM_0 = '0202SOH17040116'
DELETE FROM SORDER WHERE SOHNUM_0 = '0202SOH17040116'
SELECT * FROM STOALL WHERE VCRNUM_0 = '0202SOH17040116'

SELECT * FROM ORDERS WHERE ITMREF_0 LIKE 'ISQ%'
SELECT * FROM ITMBPS WHERE ITMREF_0 LIKE 'ISQ%' AND BPSNUM_0 = 'YN-003'

--DELETE FROM ITMBPS WHERE ITMREF_0 LIKE 'ISQ%' AND BPSNUM_0 = 'YN-003'

SELECT * FROM SORDERQ WHERE ITMREF_0 LIKE 'ISQ%' AND STOFCY_0 = '0202'
SELECT * FROM PORDERQ

SELECT T1.SOHNUM_0,
		T2.POHNUM_0,
		T3.SOHNUM_0,
		T4.VCRNUMORI_0
FROM SORDERQ T1
	LEFT JOIN PORDERQ T2 ON T1.SOHNUM_0 = T2.SOHNUM_0 AND T1.SOPLIN_0 = T2.SOPLIN_0
	RIGHT JOIN SORDERQ T3 ON T2.POHNUM_0 = T3.POHNUM_0 AND T2.POPLIN_0 = T3.POPLIN_0 
	RIGHT JOIN (SELECT VCRNUMORI_0,VCRLINORI_0,ITMREF_0 FROM ORDERS WHERE ITMREF_0 IN ('ISQ4080','ISQ6080','ISQ6097','ISQ7077','ISQ7079') AND STOFCY_0 = '0202' AND BPRNUM_0 = 'YN-001' AND VCRNUMORI_0 <> '') T4 ON T3.SOHNUM_0 = T4.ITMREF_0 AND T3.SOPLIN_0 = T4.VCRLINORI_0
WHERE T3.ITMREF_0 LIKE 'ISQ%' AND T3.SALFCY_0 = '0202'AND T1.SOHNUM_0 IS NULL

SELECT * FROM SORDERQ WHERE SOHNUM_0 IN ('0202SOH17020067','0202SOH17030035','0202SOH17020203','0202SOH17040088','0202SOH17020214','0202SOH17020203','0202SOH17040052','0202SOH17040111'
) AND ITMREF_0 LIKE 'ISQ%'

DELETE FROM ORDERS WHERE VCRNUMORI_0 IN ('0202SOH17020067','0202SOH17030035','0202SOH17020203','0202SOH17040088','0202SOH17020214','0202SOH17020203','0202SOH17040052','0202SOH17040111'
) AND ITMREF_0 LIKE 'IZT6071'

SELECT * FROM ORDERS WHERE VCRNUMORI_0 = '0202SOH17020225' AND ITMREF_0 = 'IZT6071'
SELECT VCRNUMORI_0,VCRLINORI_0,ITMREF_0 FROM ORDERS WHERE ITMREF_0 IN ('ISQ4080','ISQ6080','ISQ6097','ISQ7077','ISQ7079') AND STOFCY_0 = '0202' AND BPRNUM_0 = 'YN-001' AND VCRNUMORI_0 <> ''
SELECT * FROM ORDERS
SELECT SOHNUM_0 FROM SORDERQ WHERE SOHNUM_0 IN ('0202SOH17010135','0202SOH17040032','0202SOH17020132','0202SOH17040032','0202SOH17010133','0202SOH17010143','0202SOH17010148','0202SOH17020201','0202SOH17010143') GROUP BY SOHNUM_0

DELETE FROM SORDERP WHERE SOHNUM_0 = '0202SOH17040032' AND ITMREF_0 = 'ISQ0097'


BEGIN TRANSACTION
DECLARE @NUM NVARCHAR
DECLARE @ITM NVARCHAR
SET @NUM = '0202SOH17040032'
SET @ITM = 'ISQ0080'
BEGIN TRY
	DELETE FROM SORDERQ WHERE SOHNUM_0 = '0202SOH17010143' AND ITMREF_0 = 'ISQ0077'
	DELETE FROM SORDERP WHERE SOHNUM_0 = '0202SOH17010143'AND ITMREF_0 = 'ISQ0077'
	COMMIT
END TRY
BEGIN CATCH
	ROLLBACK
END CATCH

BEGIN TRANSACTION
BEGIN TRY
	DECLARE @NUM1 NVARCHAR
	SET @NUM1 = '0202SOH17010143'
	DELETE FROM SORDER WHERE SOHNUM_0 ='0202SOH17010143'
	DELETE FROM SORDERP WHERE SOHNUM_0 ='0202SOH17010143'
	DELETE FROM SORDERQ WHERE SOHNUM_0 = '0202SOH17010143'
	COMMIT
END TRY
BEGIN CATCH
	ROLLBACK
END CATCH

SELECT * FROM STOCK

SELECT ITMREF_0,SUM(RETQTY_0) MFGQTY_0 FROM MFGMAT WHERE MFGFCY_0 = '0202' AND (MFMTRKFLG_0 BETWEEN 1 AND 4) GROUP BY ITMREF_0
SELECT ITMREF_0,SUM(QTYSTU_0) STOQTY_0 FROM STOCK WHERE STOFCY_0 = '0202' GROUP BY ITMREF_0

SELECT ISNULL(T1.ITMREF_0,0) N'产品',
		T2.STOQTY_0 N'M04库存',
		T1.MFGQTY_0 N'工单需求',
		(CASE WHEN T2.STOQTY_0 > T1.MFGQTY_0 THEN 0 ELSE MFGQTY_0 - ISNULL(T2.STOQTY_0,0) END) N'需求'
FROM (SELECT ITMREF_0,SUM(RETQTY_0) MFGQTY_0 FROM MFGMAT WHERE MFGFCY_0 = '0202' AND (MFMTRKFLG_0 BETWEEN 1 AND 4) GROUP BY ITMREF_0) T1
	LEFT JOIN (SELECT ITMREF_0,SUM(QTYSTU_0) STOQTY_0 FROM STOCK WHERE STOFCY_0 = '0202' AND LOC_0 = 'M04' GROUP BY ITMREF_0)T2 ON T1.ITMREF_0 = T2.ITMREF_0
WHERE T2.STOQTY_0 > T1.MFGQTY_0



SELECT T1.SOHNUM_0,
		T2.SOHNUM_0,
		T3.SOHNUM_0
FROM SORDERP T1
	FULL JOIN (SELECT SOHNUM_0,ITMREF_0 FROM SORDERQ) T2 ON T1.SOHNUM_0 = T2.SOHNUM_0 AND T1.ITMREF_0 = T2.ITMREF_0
	FULL JOIN (SELECT SOHNUM_0 FROM SORDER) T3 ON T1.SOHNUM_0 = T3.SOHNUM_0 AND T2.SOHNUM_0 = T3.SOHNUM_0
WHERE T1.SALFCY_0 = '0202'

SELECT * FROM SORDERP WHERE SOHNUM_0 NOT IN (SELECT SOHNUM_0 FROM SORDERQ GROUP BY SOHNUM_0)
SELECT * FROM SORDERP WHERE SOHNUM_0 NOT IN (SELECT SOHNUM_0 FROM SORDERQ GROUP BY SOHNUM_0)

SELECT T2.SOHNUM_0,T2.SOPLIN_0
FROM SORDERQ T1
	FULL JOIN SORDERP T2 ON T1.SOHNUM_0 = T2.SOHNUM_0 AND T1.SOPLIN_0 = T2.SOPLIN_0
WHERE T1.SOHNUM_0  IS NULL

DELETE FROM SORDERP WHERE SOHNUM_0 = '0202SOH17030035' AND SOPLIN_0 = '2000'

SELECT * FROM SORDERP WHERE SOHNUM_0 = '0202SOH17010133'

DELETE FROM ORDERS WHERE ITMREF_0 LIKE 'ISQ%' AND STOFCY_0 = '0202' AND ITMREFORI_0  = ''


